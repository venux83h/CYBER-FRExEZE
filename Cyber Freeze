local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- ======================
-- SCREEN GUI
-- ======================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CyberFreezeUI"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

-- ======================
-- LOADING SCREEN
-- ======================
local LoadingFrame = Instance.new("Frame")
LoadingFrame.Size = UDim2.fromScale(1, 1)
LoadingFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
LoadingFrame.BorderSizePixel = 0
LoadingFrame.Parent = ScreenGui

local LoadingText = Instance.new("TextLabel")
LoadingText.Size = UDim2.fromOffset(400, 40)
LoadingText.Position = UDim2.new(0.5, -200, 0.3, 0)
LoadingText.BackgroundTransparency = 1
LoadingText.Text = "Loading CYBER FREEZE"
LoadingText.Font = Enum.Font.Code
LoadingText.TextSize = 26
LoadingText.TextColor3 = Color3.fromRGB(0, 170, 255)
LoadingText.Parent = LoadingFrame

local BarBG = Instance.new("Frame")
BarBG.Size = UDim2.fromOffset(320, 14)
BarBG.Position = UDim2.new(0.5, -160, 0.6, 0)
BarBG.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
BarBG.BorderSizePixel = 0
BarBG.Parent = LoadingFrame

local BarBGCorner = Instance.new("UICorner")
BarBGCorner.CornerRadius = UDim.new(0, 8)
BarBGCorner.Parent = BarBG

local BarFill = Instance.new("Frame")
BarFill.Size = UDim2.new(0, 0, 1, 0)
BarFill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
BarFill.BorderSizePixel = 0
BarFill.Parent = BarBG

local BarFillCorner = Instance.new("UICorner")
BarFillCorner.CornerRadius = UDim.new(0, 8)
BarFillCorner.Parent = BarFill

-- ======================
-- MAIN UI CREATION
-- ======================
local function CreateMainUI()
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.fromOffset(150, 50)
    MainFrame.Position = UDim2.new(0.5, -75, 0.8, 0)
    MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    MainFrame.BackgroundTransparency = 0.9
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Parent = ScreenGui

    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 10)
    Corner.Parent = MainFrame

    local Stroke = Instance.new("UIStroke")
    Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    Stroke.Thickness = 3
    Stroke.Color = Color3.fromRGB(0, 170, 255)
    Stroke.Parent = MainFrame

    local Button = Instance.new("TextButton")
    Button.Size = UDim2.fromScale(1, 1)
    Button.BackgroundTransparency = 1
    Button.Text = "FREEZE"
    Button.Font = Enum.Font.GothamBold
    Button.TextSize = 18
    Button.TextColor3 = Color3.fromRGB(0, 170, 255)
    Button.Active = false -- lets drag work through button
    Button.AutoButtonColor = false
    Button.Parent = MainFrame

    -- Pulse effect
    TweenService:Create(
        Stroke,
        TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
        {Thickness = 5, Transparency = 0.3}
    ):Play()

    -- ======================
    -- DRAG SYSTEM (MULTI-TOUCH SAFE)
    -- ======================
    local dragging = false
    local dragStart
    local startPos
    local dragInput -- tracks which finger / mouse is dragging

    local function update(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end

    MainFrame.InputBegan:Connect(function(input)
        if dragging then return end -- ignore if already dragging
        if input.UserInputType == Enum.UserInputType.MouseButton1
        or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            dragInput = input -- track this input only
        end
    end)

    MainFrame.InputEnded:Connect(function(input)
        if input == dragInput then
            dragging = false
            dragInput = nil
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            update(input)
        end
    end)

    -- ======================
    -- FREEZE BUTTON LOGIC
    -- ======================
    local freezing = false
    Button.MouseButton1Click:Connect(function()
        if freezing then return end
        freezing = true

        Button.Text = "FREEZING..."
        Stroke.Color = Color3.fromRGB(255, 255, 255)

        task.wait(0.05)
        local start = os.clock()
        while os.clock() - start < 0.5 do end

        Button.Text = "FREEZE"
        Stroke.Color = Color3.fromRGB(0, 170, 255)
        freezing = false
    end)
end

-- ======================
-- LOADING LOGIC
-- ======================
local progress = 0
local speed = 0.25
local conn
conn = RunService.Heartbeat:Connect(function(dt)
    progress += dt * speed
    progress = math.clamp(progress, 0, 1)

    BarFill.Size = UDim2.new(progress, 0, 1, 0)

    if progress >= 1 then
        conn:Disconnect()
        task.wait(0.3)
        LoadingFrame:Destroy()
        CreateMainUI()
    end
end)
